!function(a,b){"function"==typeof define&&define.amd?define([],b):a.CanAdmin=b()}(this,function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.slice(0,n.length-1).concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){var c=v.call(arguments,0);return"string"!=typeof c[0]&&1===c.length&&c.push(null),n.apply(d,c.concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){if("string"!=typeof a)throw new Error("See almond README: incorrect module build, no module name");b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../bower_components/almond/almond",function(){}),c("properties/base",[],function(){var a=can.Construct.extend({defaults:{key:"name"}},{init:function(a){"string"==typeof a&&(a={key:a}),a=can.extend({},this.constructor.defaults,a),this.options=a},getKey:function(){return this.options.key},getName:function(){return this.options.displayName||can.capitalize(this.getKey())},getType:function(){return this.options.type},setType:function(a){this.options.type=a},isEnabled:function(a){return this.options.actions?-1!==can.inArray(a,this.options.actions):!this.options.disabled},getDisplay:function(a){return a[this.getKey()]},getWidget:function(a){return this.getDisplay(a)},widgetCallback:function(a){var b=this.options.widgetCallback;"function"==typeof b&&window.setTimeout(function(){b(can.$(a))})},parseValue:function(a){return a}});return a}),c("properties/text-simple",["./base"],function(a){var b=a.extend({getWidget:function(a){return this.widgetCallback("input[name='"+this.getKey()+"']"),can.view.render("../views/prop-input.stache",{name:this.getKey(),value:this.getDisplay(a)})}});return b}),c("properties/text-long",["./text-simple"],function(a){var b=a.extend({getWidget:function(a){return this.widgetCallback("textarea[name='"+this.getKey()+"']"),can.view.render("../views/prop-textarea.stache",{name:this.getKey(),value:this.getDisplay(a),rows:this.options.rows||3})}});return b}),c("properties/select",["./base"],function(a){var b=a.extend({defaults:{displayProperty:"name"}},{getSelected:function(a){return a[this.getKey()]},getDisplay:function(a){var b=this.getSelected(a),c=can.grep(this.options.values,function(a){return a.value===b});return c.length?c[0].name:can.capitalize(b)},getWidget:function(a){this.widgetCallback("select[name='"+this.getKey()+"']");var b=this.getSelected(a),c=can.map(this.options.values,function(a){return a.selected=a.value===b,a});return can.view.render("../views/prop-select.stache",{name:this.getKey(),multiple:this.options.multiple,options:c,displayProperty:this.options.displayProperty})}});return b}),c("properties/list",["./select"],function(a){var b=a.extend({isList:!0,getSelected:function(a){return a[this.getKey()]||[]},getDisplay:function(a){var b=[],c=this.options.values;return can.each(this.getSelected(a),function(a){var b=can.grep(c,function(b){return b.value===a});name.push(b.length?b[0].name:can.capitalize(a))}),b.join(", ")}});return b}),c("properties/mapped",["./base"],function(a){var b=a.extend({defaults:{displayProperty:"name"}},{_asyncRenderValue:function(a,b){var c=this;a&&this.getOne(b,a).done(function(a){can.$("."+c._asyncReplaceClass(b)).text(a.attr(c.getDisplayProperty()))})},_asyncReplaceClass:function(a){var b=this.getProperty(a);return b?this.getKey()+"-"+b[b.constructor.id]:this.getKey()},getDisplay:function(a,b){var c=this._asyncRenderValue(this.getProperty(a),a,b);return can.view.render("../views/prop-display.stache",{cssClass:this._asyncReplaceClass(a),val:c})},getPropertyID:function(a){return a[a.constructor.id]},getSelectedId:function(a){var b=this.getProperty(a);return b?this.getPropertyID(b):!1},getWidgetTemplate:function(){return"radio"===this.options.widgetType?"../views/prop-radio.stache":"../views/prop-select.stache"},getWidget:function(a){this.viewParams={name:this.getKey(),options:new can.List([]),cssClass:this._asyncReplaceClass(a),multiple:this.isList};var b=this;this.getAll(a).done(function(c){var d=[];c.forEach(function(c){d.push(b.prepareOptionForDisplay(c,a))}),b.viewParams.options.replace(d),b.widgetCallback("."+b._asyncReplaceClass(a))});var c=this.getWidgetTemplate();return can.view.render(c,this.viewParams)},addWidgetOption:function(a,b,c){this.viewParams.selected=c||this.viewParams.selected;var d=this.prepareOptionForDisplay(b,a);d.selected=!0,this.viewParams.options.push(d),can.$("."+this._asyncReplaceClass(a)).trigger("change")},prepareOptionForDisplay:function(a,b){var c=a.constructor&&a.constructor.id?a[a.constructor.id]:a.value,d=this.getDisplayProperty(),e=this.getSelectedId(b);return{value:c,displayName:d?can.getObject(d,a):can.capitalize(c),selected:this.isList?-1!==can.inArray(c,e):c===e}},getDisplayProperty:function(){return this.options.displayProperty||"name"},getModel:function(a){if(a.constructor.attributes){var b=a.constructor.attributes[this.getKey()].replace(/\.models?$/,"");return can.getObject(b,window)}var c=a.define[this.getKey()],d=c.Type||(c.type?c.type().constructor:void 0);return d.Map||d},getProperty:function(a){return a[this.getKey()]},getOne:function(a,b){return this.getModel(a).findOne({id:this.getPropertyID(b)})},getAll:function(a){var b={},c=this.getModel(a),d=this.getType();return d&&(b=can.extend(d.getQueryParameters("findAll"),d.getPagingParameters(!0)),d.sortParameter&&d.sortProperty&&(b[d.sortParameter]=d.sortProperty),c=d.model),this.options.queryParameters&&this.options.queryParameters.findAll&&can.extend(b,this.options.queryParameters.findAll),c.findAll(b)},parseValue:function(a){return{id:a}}});return b}),c("properties/list-mapped",["./mapped"],function(a){var b=a.extend({isList:!0,_asyncRenderValue:function(a,b,c){if("list"===c)return a?a.length:0;var d=this;this.getAll(b).done(function(){var c=a.map(function(a){return a.attr(d.getDisplayProperty())}).join(", ");can.$("."+d._asyncReplaceClass(b)).text(c)})},_asyncReplaceClass:function(a){var b=this.getProperty(a);return b?b.constructor.fullName+"-"+this.getKey():this.getKey()},getWidgetTemplate:function(){return"checkbox"===this.options.widgetType?"../views/prop-list-checkbox.stache":"../views/prop-select.stache"},getSelectedId:function(a){var b=this.getProperty(a),c=this.getPropertyID;return b?can.map(b,function(a){return c(a)}):[]}});return b}),c("properties/list-mapped-one2one",["./list-mapped"],function(a){var b=a.extend({getAll:function(a){var b=this,c=this.getProperty(a),d=new can.Deferred;if(!c||!c.length)return d.resolve([]);var e=can.map(c,function(c){return b.getOne(a,c)});return can.when.apply(null,e).done(function(){d.resolve(Array.prototype.slice.apply(arguments))}),d}});return b}),c("properties/bool",["./base"],function(a){var b=a.extend({defaults:{value:!0}},{getDisplay:function(a){return this.isOn(a)?"☑":"☐"},getWidget:function(a){return this.widgetCallback("input[name='"+this.getKey()+"']"),can.view.render("../views/prop-checkbox.stache",{name:this.getKey(),value:this.options.value,checked:this.isOn(a)})},isOn:function(a){return a[this.getKey()]===this.options.value}});return b}),c("properties",["./properties/text-simple","./properties/text-long","./properties/select","./properties/list","./properties/mapped","./properties/list-mapped","./properties/list-mapped-one2one","./properties/bool"],function(a,b,c,d,e,f,g,h){var i={TextSimple:a,TextLong:b,Select:c,List:d,Mapped:e,ListMapped:f,ListMappedOne2One:g,Bool:h};return i}),function(){can.view.preloadStringRenderer("views_admin_stache",can.stache('<div class="can-admin">\n    <header>\n        <h2>Admin Area</h2>\n    </header>\n    <nav class="admin-breadcrumb"></nav>\n    <nav class="admin-entities">\n        <ul>\n            {{#types}}\n                {{#if isShowInMenu }}\n                <li>\n                    <a href="{{getRoute}}">\n                        <i class="icon-{{getIcon}}"></i>\n                        {{getNamePlural}}\n                    </a>\n                </li>\n                {{/if}}\n            {{/types}}\n        </ul>\n        {{#if pages}}\n        <hr>\n        <ul>\n            {{#pages}}\n                <li>\n                    <a href="{{getRoute}}">\n                        <i class="icon-{{getIcon}}"></i>\n                        {{getName}}\n                    </a>\n                </li>\n            {{/pages}}\n        </ul>\n        {{/if}}\n    </nav>\n    <div class="admin-content"></div>\n</div>\n')),can.view.preloadStringRenderer("views_breadcrumb_stache",can.stache('<a href="{{url}}">{{text}}</a>\n')),can.view.preloadStringRenderer("views_edit-inline_stache",can.stache('<div class="admin-edit-inline">\n    <div class="admin-edit-overlay">\n        <h2>{{type.getName}}</h2>\n        <div class="admin-edit-form"></div>\n    </div>\n</div>\n')),can.view.preloadStringRenderer("views_edit_stache",can.stache('<form class="form-horizontal">\n    {{#each properties}}\n    <div class="control-group">\n        <label class="control-label" for="admin-edit-{{key}}">{{label}}</label>\n        <div class="controls">\n            <div {{appendDocFrag widget}}></div>\n            {{#if canCreate}}\n                <a {{data "property" property}} href="#" class="admin-edit-create">Create new</a>\n            {{/if}}\n        </div>\n    </div>\n    {{/each}}\n    {{#if canUpdate}}\n    <div class="control-group">\n        <div class="controls">\n            <button type="submit" class="btn btn-primary">Save</button>\n            {{#if inline}}\n            <button class="btn admin-edit-close">Close</button>\n            {{/if}}\n        </div>\n    </div>\n    {{/if}}\n</form>\n')),can.view.preloadStringRenderer("views_list_stache",can.stache('<header>\n    <h2>{{type.getNamePlural}}</h2>\n    {{#if canCreate}}\n        <a class="btn btn-primary" href="{{type.getCreateRoute}}"><i class="icon-plus"></i> Create new</a>\n    {{/if}}\n    {{#if canSearch}}\n        <form class="form-search">\n            <input type="text" class="admin-list-search search-query" placeholder="Search">\n            <button type="reset" class="btn admin-list-reset">Clear</button>\n        </form>\n    {{/if}}\n</header>\n<table>\n    <tr>\n        {{#each type.list}}\n            <th>\n                {{#if options.orderBy}}\n                <a href="#" class="sortable asc" data-order-by="{{options.orderBy}}">\n                    {{getName}}\n                </a>\n                {{else}}\n                    {{getName}}\n                {{/if}}\n            </th>\n        {{/each}}\n        {{#if canUpdate}}<th>Edit</th>{{/if}}\n        {{#if canDestroy}}<th>Delete</th>{{/if}}\n    </tr>\n    <tbody class="items">\n        {{#each items}}\n        <tr {{data "item" item}} class="{{cssClass}}">\n            <td>\n                <a href="{{route}}">{{label}}</a>\n            </td>\n            {{#properties}}\n            <td {{appendDocFrag this}}>\n            </td>\n            {{/properties}}\n            {{#if canUpdate}}<td><a href="{{route}}">Edit</a></td>{{/if}}\n            {{#if canDestroy}}<td><a href="#" class="delete">Delete</a></td>{{/if}}\n        </tr>\n        {{/each}}\n    </tbody>\n</table>\n<div class="admin-list-paging"></div>\n')),can.view.preloadStringRenderer("views_paginate_stache",can.stache('<div class="pagination">\n  <ul>\n    <li class="{{#unless prev}}disabled{{/unless}}">\n        {{#if prev}}\n            <a href="{{prev}}" title="Previous Page">&laquo;</a>\n        {{else}}<a>&laquo;</a>{{/if}}\n    </li>\n    {{#pages}}\n    <li class="{{#active}}active{{/active}}">\n        <a href="{{url}}">{{page}}</a>\n    </li>\n    {{/pages}}\n    <li class="{{#unless next}}disabled{{/unless}}">\n        {{#if next}}\n            <a href="{{next}}" title="Next Page">&raquo;</a>\n        {{else}}<a>&raquo;</a>{{/if}}\n    </li>\n  </ul>\n</div>\n')),can.view.preloadStringRenderer("views_prop-checkbox_stache",can.stache('<input type="checkbox" value="{{value}}" name="{{name}}" id="admin-edit-{{name}}"{{#checked}} checked{{/checked}}>\n')),can.view.preloadStringRenderer("views_prop-display_stache",can.stache('<span class="{{cssClass}}">{{val}}</span>\n')),can.view.preloadStringRenderer("views_prop-input_stache",can.stache('<input type="text" name="{{name}}" id="admin-edit-{{name}}" value="{{value}}">\n')),can.view.preloadStringRenderer("views_prop-list-checkbox_stache",can.stache('<div class="row-fluid admin-list-checkbox {{cssClass}}">\n{{#each options}}\n    <label>\n        <input type="checkbox" name="{{name}}" value="{{value}}"{{#selected}} checked{{/selected}}>\n        {{displayName}}\n    </label>\n{{/each}}\n</div>\n')),can.view.preloadStringRenderer("views_prop-radio_stache",can.stache('<div class="{{cssClass}}">\n{{#each options}}\n    <label>\n        <input type="radio" name="{{name}}" value="{{value}}"{{#selected}} checked{{/selected}}>\n        {{displayName}}\n    </label>\n{{/each}}\n</div>\n')),can.view.preloadStringRenderer("views_prop-select_stache",can.stache('<select class="{{cssClass}}"\n    style="min-width: 220px; max-width: 600px;"\n    id="admin-edit-{{name}}"\n    name="{{name}}"\n    {{#multiple}}multiple size=\'3\'{{/multiple}}>\n    {{#each options}}\n        <option value="{{value}}"{{#selected}} selected{{/selected}}>\n            {{displayName}}\n        </option>\n    {{/each}}\n</select>\n')),can.view.preloadStringRenderer("views_prop-textarea_stache",can.stache('<textarea class="{{cssClass}}" id="admin-edit-{{name}}" name="{{name}}" rows="{{rows}}">{{{value}}}</textarea>\n'))}(this),c("views",function(){}),c("controls/list",["../views"],function(){var a=can.Control.extend({init:function(a,b){this.items=new can.List([]),this.renderPage(),b.search?(a.find(".admin-list-search").val(b.search),this.loadSearch(b.search)):this.loadPage(b.page)},"{routes.list} route":function(a){a.type===this.options.type.name&&this.loadPage()},"{routes.listPage} route":function(a){this.loadPage(a.page)},"{routes.listSearch} route":function(a){this.loadSearch(a.search)},renderPage:function(){this.element.html(can.view("../views/list.stache",{type:this.options.type,canCreate:this.options.type.canCreate(),canSearch:this.options.type.canSearch(),canUpdate:this.options.type.canUpdate(),canDestroy:this.options.type.canDestroy(),items:this.items}))},loadPage:function(a){var b=this;a=can.isNumeric(a)?a:void 0,this.options.type.getAll(a).done(function(c){b.displayItems(c),b.initPaging(a),b.element.removeClass("admin-list-searchresults")})},displayItems:function(a){var b=this.options.type.list,c=[];a.forEach(function(a,d){var e={route:a.getRoute(),label:a.getDisplay(b[0],"list"),properties:[],cssClass:d%2===0?"even":"odd",item:a};b.forEach(function(b,c){c>0&&e.properties.push(a.getDisplay(b,"list"))}),c.push(e)}),this.items.replace(c)},initPaging:function(a){var b=this.options.type.getPagingParameters(),c=this.items.length!==b.max;if(a||!c){this.hasOwnProperty("count")||(this.count=this.options.type.getCount());var d=this;this.count.done(function(e){if(!(e<=b.max)&&d.element){var f=d.options.routes.listPage,g=d.options.type.name;a=parseInt(a)||0;for(var h=Math.floor(e/b.max),i=e?h>a:!c,j=[],k=0;h>=k;k++)(15>h||k>a-4&&a+4>k||(k+1)%10===0||0===k||k===h-1)&&j.push({page:k+1,active:a===k||!a&&0===k,url:can.route.url({route:f,type:g,page:k})});d.element.find(".admin-list-paging").html(can.view("../views/paginate.stache",{next:i?can.route.url({route:f,type:g,page:a+1}):void 0,prev:a>0?can.route.url({route:f,type:g,page:a-1}):void 0,pages:j}))}})}},loadSearch:function(a){this.element.addClass("admin-list-searchresults");var b=this;this.options.type.getSearch(a).done(function(c){a!==b.lastSearchTerm&&b.lastSearchTerm||b.displayItems(c)})},resetSearch:function(){window.location.hash=can.route.url({route:this.options.routes.list,type:this.options.type.name})},".delete click":function(a,b){b.preventDefault();var c=a.closest("tr"),d=c.data("item"),e=d();window.confirm("Delete '"+e.getName()+"'?")&&e.destroy().done(function(){c.remove()})},".admin-list-search keyup":function(a,b){b.preventDefault();var c=a.val();if(this.lastSearchTerm=c,27===b.which)return a.val(""),void this.resetSearch();if(13!==b.which){var d=this;window.setTimeout(function(){c===d.lastSearchTerm&&(window.location.hash=can.route.url({route:d.options.routes.listSearch,type:d.options.type.name,search:c}),d.element.find(".admin-list-paging").empty())},200)}},".admin-list-reset click":function(){this.resetSearch()},".sortable click":function(a,b){b.preventDefault(),this.element.find(".sortable.active").removeClass("active"),a.addClass("active").removeClass("desc asc");var c=a.data("orderBy"),d=this.options.type;c!==d.sortProperty?(d.sortProperty=c,delete d.currentSortType,a.addClass("asc")):d.currentSortType&&d.currentSortType!==d.sortAscending?(d.currentSortType=d.sortAscending,a.addClass("asc")):(d.currentSortType=d.sortDescending,a.addClass("desc")),this.loadPage()}});return a}),c("controls/edit",["../views"],function(){var a=can.Control.extend({init:function(a,b){this.loadItem=can.when(b.id?b.type.getOne(b.id):b.type.createNew());var c=this;this.loadItem.done(function(d){c.item=d;var e=c.options.inline?a.find(".admin-edit-form"):a;e.html(can.view("../views/edit.stache",{type:b.type,canUpdate:b.type.canUpdate(),inline:b.inline,item:d,properties:c.getEditProperties()}))})},getEditProperties:function(){var a=[],b=this.item;return this.options.type.edit.forEach(function(c){if(!b.instance.isNew()||c.isEnabled(b.instance.isNew()?"create":"update")){var d=c.getType();a.push({key:c.getKey(),label:c.getName(),widget:b.getWidget(c),canCreate:d?d.canCreate():!1,property:c})}},this),a},close:function(a){"function"==typeof this.options.onClose&&this.options.onClose(a),this.options.inline?this.element.remove():window.location.hash=this.options.type.getRoute()},"form submit":function(a,b){b.preventDefault();var c=this.item.saveForm(a);if(this.options.inline){var d=this;c.done(function(a){d.close(a)})}},".admin-edit-create click":function(b,c){c.preventDefault();var d=b.data("property"),e=d.getType(),f=this;this.element.after(can.view("../views/edit-inline.stache",{type:e}));new a(this.element.next(),{type:e,inline:!0,onClose:function(a){if(a){var c=f.item.serializeForm(b.closest("form")),e=can.map(c[d.getKey()]||[],function(a){return a.id});e.push(a.id),d.addWidgetOption(f.item.instance,a,e)}}})},".admin-edit-close click":function(a,b){b.preventDefault(),this.close()}});return a}),c("controls/helpers",[],function(){can.stache.registerHelper("appendDocFrag",function(a){return function(b){a instanceof Node?b.appendChild(a):can.$(b).append(a)}})}),c("controls/main",["./list","./edit","./helpers","../views"],function(a,b){var c=can.Control.extend({defaults:{routes:{main:"admin",page:"admin/page/:page",list:"admin/list/:type",listPage:"admin/list/:type/page/:page",listSearch:"admin/list/:type/search/:search",create:"admin/list/:type/create",edit:"admin/list/:type/edit/:id"}}},{setup:function(a,b){var c=b.types||(this.constructor.defaults?this.constructor.defaults.types:void 0),d=b.routes||this.constructor.defaults.routes;c&&c.forEach(function(a){if(a.routes=d,a.properties)for(var b in a.properties){var e=a.properties[b],f=e.getType();if(f&&"string"==typeof f){var g=this.getType(f,c);e.setType(g||void 0)}}},this);var e=b.pages||(this.constructor.defaults?this.constructor.defaults.pages:void 0);e&&e.forEach(function(a){a.routes=d}),can.Control.prototype.setup.call(this,a,b)},"{routes.main} route":"dashboard","{routes.list} route":"list","{routes.listPage} route":"list","{routes.listSearch} route":"list","{routes.create} route":"create","{routes.edit} route":"edit","{routes.page} route":"page",init:function(){this.initHtml(),can.route.ready()},initHtml:function(){this.element.html(can.view("../views/admin.stache",{types:this.options.types,pages:this.options.pages}))},dashboard:function(){this.breadcrumb()},list:function(b){if(this.currentList!==b.type){this.breadcrumb(),this.currentList=b.type;{new a(this.element.find(".admin-content"),can.extend(b,{type:this.getType(b.type),routes:this.options.routes}))}}},create:function(a){this.breadcrumb();new b(this.element.find(".admin-content"),{type:this.getType(a.type)})},edit:function(a){this.breadcrumb();var c=new b(this.element.find(".admin-content"),{type:this.getType(a.type),id:a.id}),d=this;c.loadItem.done(function(a){d.appendToBreadcrumb(a.getName(),a.getRoute())})},page:function(a){this.breadcrumb();var b=this.getPage(a.page);b.initControl(this.element.find(".admin-content"))},getType:function(a,b){return b=b||this.options.types,can.grep(b,function(b){return b.name===a})[0]},getPage:function(a){return can.grep(this.options.pages,function(b){return b.name===a})[0]},breadcrumb:function(){delete this.currentList,this.element.find(".admin-breadcrumb").empty().length||this.initHtml(),this.element.find(".admin-content").replaceWith("<div class='admin-content'></div>"),this.appendToBreadcrumb("Admin",can.route.url({route:this.options.routes.main}));var a=can.route.attr();if(a.type){var b=this.getType(a.type);this.appendToBreadcrumb(b.getName(),b.getRoute())}else if(a.page){var c=this.getPage(a.page);this.appendToBreadcrumb(c.getName(),c.getRoute())}},appendToBreadcrumb:function(a,b){this.element.find(".admin-breadcrumb").append(can.view("../views/breadcrumb.stache",{url:b,text:a}))}});return c}),c("controls",["./controls/main","./controls/list","./controls/edit"],function(a,b,c){var d={Main:a,List:b,Edit:c};return d}),c("item",[],function(){var a=can.Construct.extend({init:function(a){for(var b in a)this[b]=a[b]},getName:function(){var a=this.displayProperty||this.type.displayProperty||"name",b=can.getObject(a,this.type.properties);return this.getDisplay(b)},getRoute:function(){return can.route.url({route:this.type.routes.edit,type:this.type.name,id:this.instance[this.instance.constructor.id||"id"]})},getDisplay:function(a,b){return a.getDisplay(this.instance,b)},getWidget:function(a){var b=this.instance.isNew()?"create":"update";return this.type.canUpdate()&&a.isEnabled(b)?a.getWidget(this.instance):can.$("<span class='ro-property'></span>").append(this.getDisplay(a,"edit"))},serializeForm:function(a){var b=a.serializeArray(),c={};return b.forEach(function(a){var b=this.type.getProperty(a.name),d=b.parseValue(a.value);b&&b.isList?(c[a.name]=c[a.name]||[],c[a.name].push(d)):c[a.name]=d},this),c},save:function(a){this.type.edit.forEach(function(b){var c=a[b.getKey()],d=b.getKey();void 0===c?this.instance.removeAttr(d):this.instance.attr(d,c)},this);var b=this.instance.save();return this.instance.isNew()?this.callback(b,"onCreate"):this.callback(b,"onUpdate"),this.callback(b,"onError","fail"),b},saveForm:function(a){return this.save(this.serializeForm(a))},destroy:function(){var a=this.instance.destroy();return this.callback(a,"onDestroy"),this.callback(a,"onError","fail"),a},callback:function(a,b,c){if(this.type.callbacks){var d=this.type.callbacks[b];c=c||"done","function"==typeof d&&a[c](d)}}});return a}),c("type",["./item"],function(a){var b=can.Construct.extend({defaults:{actions:["create","update","destroy"],icon:"cog",paging:{limit:"limit",offset:"offset",n:25,noLimit:0},sortParameter:"orderBy",sortType:"orderType",sortAscending:"ASC",sortDescending:"DESC",showInMenu:!0}},{init:function(a){a=can.extend({},this.constructor.defaults,a);var b=function(b){return a.properties[b]},c=function(a){switch(typeof a){case"function":return a;case"string":return function(b){return can.getJSON(can.sub(a,b,!1))}}throw"No valid service definition "+a};for(var d in a)if("edit"===d||"list"===d)this[d]=can.map(a[d],b);else if("services"===d){this.services={};for(var e in a.services)this.services[e]=c(a.services[e])}else this[d]=a[d];this.edit=this.edit||can.map(a.properties,function(a){return a}),this.list=this.list||[this.edit[0]]},canCreate:function(){return this.supportsAction("create")},canUpdate:function(){return this.supportsAction("update")},canDestroy:function(){return this.supportsAction("destroy")},supportsAction:function(a){return-1!==can.inArray(a,this.actions)},canSearch:function(){return!(!this.services||!this.services.search)},getName:function(){return this.displayName||can.capitalize(this.name)},getNamePlural:function(){return this.displayNamePlural||this.getName()+"s"},isShowInMenu:function(){return"function"==typeof this.showInMenu?this.showInMenu():!!this.showInMenu},getIcon:function(){return this.icon},_route:function(a){return can.route.url({route:this.routes[a],type:this.name})},getRoute:function(){return this._route("list")},getCreateRoute:function(){return this._route("create")},getProperty:function(a){for(var b in this.properties)if(this.properties[b].getKey()===a)return this.properties[b]},getPagingParameters:function(a){a=a||0;var b=this,c=function(a){return b.paging&&void 0!==b.paging[a]?b.paging[a]:b.constructor.defaults.paging[a]},d={};if(a===!0)d[c("limit")]=c("noLimit");else{var e=c("n");d[c("limit")]=e,d[c("offset")]=e*a}return d},getQueryParameters:function(a){return this.queryParameters?this.queryParameters[a]||{}:{}},getAll:function(a){var b=can.extend(this.getQueryParameters("findAll"),this.getPagingParameters(a));return this.sortParameter&&this.sortProperty&&(b[this.sortParameter]=this.sortProperty,this.currentSortType&&(b[this.sortType]=this.currentSortType)),this.returnItemList(this.model.findAll(b))},returnItemList:function(b){var c=this;return b.then(function(b){return can.map(b,function(b){return b instanceof c.model||(b=new c.model(b)),new a({type:c,instance:b})})})},getOne:function(b){var c=this,d=this.getQueryParameters("findOne");return d.id=b,this.model.findOne(d).then(function(b){return new a({type:c,instance:b})})},createNew:function(){var b=new this.model;return new a({type:this,instance:b})},getCount:function(){return this.services&&this.services.count?this.services.count(this.getQueryParameters("count")):(new can.Deferred).resolve()},getSearch:function(a){if(this.canSearch()){var b=can.extend({},this.getPagingParameters(0),this.getQueryParameters("search"),{s:a});return this.returnItemList(this.services.search(b))}return(new can.Deferred).resolve()}});return b}),c("page",[],function(){var a=can.Construct.extend({defaults:{icon:"cog"}},{init:function(a){a=can.extend({},this.constructor.defaults,a);for(var b in a)this[b]=a[b]},getRoute:function(){return can.route.url({route:this.routes.page,page:this.name})},getName:function(){return this.displayName||can.capitalize(this.name)},getIcon:function(){return this.icon},initControl:function(a){return new this.control(a,this.controlOptions)}});return a}),c("admin",["./properties","./controls","./type","./page"],function(a,b,c,d){return{Properties:a,Controls:b,Type:c,Page:d}}),b("admin")});