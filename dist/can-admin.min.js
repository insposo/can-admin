!function(a,b){"function"==typeof define&&define.amd?define([],b):a.CanAdmin=b()}(this,function(){var requirejs,require,define;return function(a){function b(a,b){return r.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=p.map,q=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,p.nodeIdCompat&&t.test(a[g])&&(a[g]=a[g].replace(t,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||q)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&q&&q[d]&&(i=q[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function d(b,c){return function(){return k.apply(a,s.call(arguments,0).concat([b,c]))}}function e(a){return function(b){return c(b,a)}}function f(a){return function(b){n[a]=b}}function g(c){if(b(o,c)){var d=o[c];delete o[c],q[c]=!0,j.apply(a,d)}if(!b(n,c)&&!b(q,c))throw new Error("No "+c);return n[c]}function h(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,k,l,m,n={},o={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice,t=/\.js$/;l=function(a,b){var d,f=h(a),i=f[0];return a=f[1],i&&(i=c(i,b),d=g(i)),i?a=d&&d.normalize?d.normalize(a,e(b)):c(a,b):(a=c(a,b),f=h(a),i=f[0],a=f[1],i&&(d=g(i))),{f:i?i+"!"+a:a,n:a,pr:i,p:d}},m={require:function(a){return d(a)},exports:function(a){var b=n[a];return"undefined"!=typeof b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:i(a)}}},j=function(c,e,h,i){var j,k,p,r,s,t,u=[],v=typeof h;if(i=i||c,"undefined"===v||"function"===v){for(e=!e.length&&h.length?["require","exports","module"]:e,s=0;s<e.length;s+=1)if(r=l(e[s],i),k=r.f,"require"===k)u[s]=m.require(c);else if("exports"===k)u[s]=m.exports(c),t=!0;else if("module"===k)j=u[s]=m.module(c);else if(b(n,k)||b(o,k)||b(q,k))u[s]=g(k);else{if(!r.p)throw new Error(c+" missing "+k);r.p.load(r.n,d(i,!0),f(k),{}),u[s]=n[k]}p=h?h.apply(n[c],u):void 0,c&&(j&&j.exports!==a&&j.exports!==n[c]?n[c]=j.exports:p===a&&t||(n[c]=p))}else c&&(n[c]=h)},requirejs=require=k=function(b,c,d,e,f){if("string"==typeof b)return m[b]?m[b](c):g(l(b,c).f);if(!b.splice){if(p=b,p.deps&&k(p.deps,p.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},4),k},k.config=function(a){return k(a)},requirejs._defined=n,define=function(a,c,d){c.splice||(d=c,c=[]),b(n,a)||b(o,a)||(o[a]=[a,c,d])},define.amd={jQuery:!0}}(),define("../bower_components/almond/almond",function(){}),define("properties/base",[],function(){var a=can.Construct.extend({defaults:{key:"name"}},{init:function(a){"string"==typeof a&&(a={key:a}),a=can.extend({},this.constructor.defaults,a),this.options=a},getKey:function(){return this.options.key},getName:function(){return this.options.displayName||can.capitalize(this.getKey())},getType:function(){return this.options.type},setType:function(a){this.options.type=a},isEnabled:function(a){return this.options.actions?-1!==can.inArray(a,this.options.actions):!this.options.disabled},getDisplay:function(a){return a[this.getKey()]},getWidget:function(a){return this.getDisplay(a)},widgetCallback:function(a){var b=this.options.widgetCallback;"function"==typeof b&&window.setTimeout(function(){b(can.$(a))})},parseValue:function(a){return a}});return a}),define("properties/text-simple",["./base"],function(a){var b=a.extend({getWidget:function(a){return this.widgetCallback("input[name='"+this.getKey()+"']"),can.view.render("../views/admin-input.ejs",{name:this.getKey(),value:this.getDisplay(a)})}});return b}),define("properties/text-long",["./text-simple"],function(a){var b=a.extend({getWidget:function(a){return this.widgetCallback("textarea[name='"+this.getKey()+"']"),can.view.render("../views/admin-textarea.ejs",{name:this.getKey(),value:this.getDisplay(a),rows:this.options.rows||3})}});return b}),define("properties/select",["./base"],function(a){var b=a.extend({getSelected:function(a){return a[this.getKey()]},getDisplay:function(a){var b=this.getSelected(a),c=can.grep(this.options.values,function(a){return a.value===b});return c.length?c[0].name:can.capitalize(b)},getWidget:function(a){return this.widgetCallback("select[name='"+this.getKey()+"']"),can.view.render("../views/admin-select.ejs",{name:this.getKey(),multiple:this.options.multiple,options:this.options.values,selected:this.getSelected(a)})}});return b}),define("properties/list",["./select"],function(a){var b=a.extend({isList:!0,getSelected:function(a){return a[this.getKey()]||[]},getDisplay:function(a){var b=[],c=this.options.values;return can.each(this.getSelected(a),function(a){var b=can.grep(c,function(b){return b.value===a});name.push(b.length?b[0].name:can.capitalize(a))}),b.join(", ")}});return b}),define("properties/mapped",["./base"],function(a){var b=a.extend({defaults:{displayProperty:"name"}},{_asyncRenderValue:function(a,b){var c=this;a&&this.getOne(b,a).done(function(a){can.$("."+c._asyncReplaceClass(b)).text(a.attr(c.getDisplayProperty()))})},_asyncReplaceClass:function(a){var b=this.getProperty(a);return b?this.getKey()+"-"+b[b.constructor.id]:this.getKey()},getDisplay:function(a,b){var c=this._asyncRenderValue(this.getProperty(a),a,b);return can.view.render("../views/admin-prop.ejs",{cssClass:this._asyncReplaceClass(a),val:c})},getPropertyID:function(a){return a[a.constructor.id]},getSelectedId:function(a){var b=this.getProperty(a);return b?this.getPropertyID(b):!1},getWidgetTemplate:function(){return"radio"===this.options.widgetType?"../views/admin-radio.ejs":"../views/admin-select.ejs"},getWidget:function(a){this.viewParams={name:this.getKey(),displayProperty:this.getDisplayProperty(),options:new can.Observe.List([]),selected:this.getSelectedId(a),cssClass:this._asyncReplaceClass(a),multiple:this.isList};var b=this;this.getAll(a).done(function(c){b.viewParams.options.replace(c),b.widgetCallback("."+b._asyncReplaceClass(a))});var c=this.getWidgetTemplate();return can.view.render(c,this.viewParams)},addWidgetOption:function(a,b,c){this.viewParams.selected=c||this.viewParams.selected,this.viewParams.options.push(b),can.$("."+this._asyncReplaceClass(a)).trigger("change")},getDisplayProperty:function(){return this.options.displayProperty||"name"},getModel:function(a){var b=a.constructor.attributes[this.getKey()].replace(/\.models?$/,"");return can.getObject(b,window)},getProperty:function(a){return a[this.getKey()]},getOne:function(a,b){return this.getModel(a).findOne({id:this.getPropertyID(b)})},getAll:function(a){var b={},c=this.getModel(a),d=this.getType();return d&&(b=can.extend(d.getQueryParameters("findAll"),d.getPagingParameters(!0)),d.sortParameter&&d.sortProperty&&(b[d.sortParameter]=d.sortProperty),c=d.model),this.options.queryParameters&&this.options.queryParameters.findAll&&can.extend(b,this.options.queryParameters.findAll),c.findAll(b)},parseValue:function(a){return{id:a}}});return b}),define("properties/list-mapped",["./mapped"],function(a){var b=a.extend({isList:!0,_asyncRenderValue:function(a,b,c){if("list"===c)return a?a.length:0;var d=this;this.getAll(b).done(function(){var c=a.map(function(a){return a.attr(d.getDisplayProperty())}).join(", ");can.$("."+d._asyncReplaceClass(b)).text(c)})},_asyncReplaceClass:function(a){var b=this.getProperty(a);return b?b.constructor.fullName+"-"+this.getKey():this.getKey()},getWidgetTemplate:function(){return"checkbox"===this.options.widgetType?"../views/admin-list-checkbox.ejs":"../views/admin-select.ejs"},getSelectedId:function(a){var b=this.getProperty(a),c=this.getPropertyID;return b?can.map(b,function(a){return c(a)}):[]}});return b}),define("properties/list-mapped-one2one",["./list-mapped"],function(a){var b=a.extend({getAll:function(a){var b=this,c=this.getProperty(a),d=new can.Deferred;if(!c||!c.length)return d.resolve([]);var e=can.map(c,function(c){return b.getOne(a,c)});return can.when.apply(null,e).done(function(){d.resolve(Array.prototype.slice.apply(arguments))}),d}});return b}),define("properties/bool",["./base"],function(a){var b=a.extend({defaults:{value:!0}},{getDisplay:function(a){return this.isOn(a)?"☑":"☐"},getWidget:function(a){return this.widgetCallback("input[name='"+this.getKey()+"']"),can.view.render("../views/admin-checkbox.ejs",{name:this.getKey(),value:this.options.value,checked:this.isOn(a)})},isOn:function(a){return a[this.getKey()]===this.options.value}});return b}),define("properties",["./properties/text-simple","./properties/text-long","./properties/select","./properties/list","./properties/mapped","./properties/list-mapped","./properties/list-mapped-one2one","./properties/bool"],function(a,b,c,d,e,f,g,h){var i={TextSimple:a,TextLong:b,Select:c,List:d,Mapped:e,ListMapped:f,ListMappedOne2One:g,Bool:h};return i}),define("views",[],function(){can.view.preload("views_admin-checkbox_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<input type="checkbox" value="'),___v1ew.push(can.view.txt(1,"input","value",this,function(){return value})),___v1ew.push('" name="'),___v1ew.push(can.view.txt(1,"input","name",this,function(){return name})),___v1ew.push('" id="admin-edit-'),___v1ew.push(can.view.txt(1,"input","id",this,function(){return name})),___v1ew.push('"'),___v1ew.push(can.view.txt(1,"input",1,this,function(){return this.checked?" checked":""})),___v1ew.push("",can.view.pending(),">"),___v1ew.push("\n"),___v1ew.join("")}})),can.view.preload("views_admin-edit-inline_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<div class="admin-edit-inline">\n    <div class="admin-edit-overlay">\n        <h2>'),___v1ew.push(can.view.txt(1,"h2",0,this,function(){return type.getName()})),___v1ew.push('</h2>\n        <div class="admin-edit-form"></div>\n    </div>\n</div>\n'),___v1ew.join("")}})),can.view.preload("views_admin-edit_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<form class="form-horizontal">\n    '),___v1ew.push(can.view.txt(0,"form",0,this,function(){var a=[];return list(type.edit,function(b){a.push("\n    "),a.push(can.view.txt(0,"form",0,this,function(){var a=[];if(!item.instance.isNew()||b.isEnabled(item.instance.isNew()?"create":"update")){a.push('\n    <div class="control-group">\n        <label class="control-label" for="admin-edit-'),a.push(can.view.txt(1,"label","for",this,function(){return b.getKey()})),a.push('"',can.view.pending(),">"),a.push(can.view.txt(1,"label",0,this,function(){return b.getName()})),a.push('</label>\n        <div class="controls">\n            '),a.push(can.view.txt(0,"div",0,this,function(){return item.getWidget(b)})),a.push("\n            ");var c=b.getType();a.push("\n            "),a.push(can.view.txt(0,"div",0,this,function(){var a=[];return c&&c.canCreate()&&(a.push("\n                <a "),a.push(can.view.txt(1,"a",1,this,function(){return can.proxy(function(a){var c=can.$(a);c.data("property",b)},this)})),a.push(' href="#" class="admin-edit-create"',can.view.pending(),">"),a.push("Create new</a>\n            ")),a.join("")})),a.push("\n        </div>\n    </div>\n    ")}return a.join("")})),a.push("\n    ")}),a.join("")})),___v1ew.push("\n    "),___v1ew.push(can.view.txt(0,"form",0,this,function(){var a=[];return type.canUpdate()&&(a.push('\n    <div class="control-group">\n        <div class="controls">\n            <button type="submit" class="btn btn-primary">Save</button>\n            '),a.push(can.view.txt(0,"div",0,this,function(){var a=[];return this.inline&&a.push('\n            <button class="btn admin-edit-close">Close</button>\n            '),a.join("")})),a.push("\n        </div>\n    </div>\n    ")),a.join("")})),___v1ew.push("\n</form>\n"),___v1ew.join("")}})),can.view.preload("views_admin-input_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<input type="text" name="'),___v1ew.push(can.view.txt(1,"input","name",this,function(){return name})),___v1ew.push('" id="admin-edit-'),___v1ew.push(can.view.txt(1,"input","id",this,function(){return name})),___v1ew.push('" value="'),___v1ew.push(can.view.txt(1,"input","value",this,function(){return value})),___v1ew.push('"',can.view.pending(),">"),___v1ew.push("\n"),___v1ew.join("")}})),can.view.preload("views_admin-list-checkbox_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];___v1ew.push('<div class="row-fluid '),___v1ew.push(can.view.txt(1,"div","class",this,function(){return this.cssClass?this.cssClass:""})),___v1ew.push('"',can.view.pending(),">"),___v1ew.push("\n");var that=this;return ___v1ew.push("\n"),___v1ew.push(can.view.txt(0,"div",0,this,function(){var a=[];return list(options,function(b,c){a.push("\n    "),a.push(can.view.txt(0,"div",0,this,function(){var a=[];return c%Math.ceil(options.length/3)===0&&a.push('\n        <div class="span4">\n    '),a.join("")})),a.push("\n    ");var d=b.constructor&&b.constructor.id?b[b.constructor.id]:b.value,e=that.displayProperty?can.getObject(displayProperty,b):can.capitalize(d),f=-1!==can.inArray(d,that.selected)?"checked":"";a.push('\n        <label>\n            <input type="checkbox" name="'),a.push(can.view.txt(1,"input","name",this,function(){return name})),a.push('" value="'),a.push(can.view.txt(1,"input","value",this,function(){return d})),a.push('" '),a.push(can.view.txt(1,"input",1,this,function(){return f})),a.push("",can.view.pending(),">"),a.push("\n            "),a.push(can.view.txt(1,"input",0,this,function(){return e})),a.push("\n        </label>\n    "),a.push(can.view.txt(0,"/label",0,this,function(){var a=[];return((c+1)%Math.ceil(options.length/3)===0||c===options.length-1)&&a.push("\n        </div>\n    "),a.join("")})),a.push("\n")}),a.join("")})),___v1ew.push("\n</div>\n"),___v1ew.join("")}})),can.view.preload("views_admin-list_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];___v1ew.push("<header>\n    <h2>"),___v1ew.push(can.view.txt(1,"h2",0,this,function(){return type.getNamePlural()})),___v1ew.push("</h2>\n"),___v1ew.push(can.view.txt(0,"header",0,this,function(){var a=[];return type.canCreate()&&(a.push('\n    <a class="btn btn-primary" href="'),a.push(can.view.txt(1,"a","href",this,function(){return type.getCreateRoute()})),a.push('"',can.view.pending(),">"),a.push('<i class="icon-plus"></i> Create new</a>\n')),a.join("")})),___v1ew.push("\n"),___v1ew.push(can.view.txt(0,"header",0,this,function(){var a=[];return type.canSearch()&&a.push('\n    <form class="form-search">\n        <input type="text" class="admin-list-search search-query" placeholder="Search">\n        <button type="reset" class="btn admin-list-reset">Clear</button>\n    </form>\n'),a.join("")})),___v1ew.push("\n</header>\n");var canDestroy=type.canDestroy(),canUpdate=type.canUpdate();return ___v1ew.push("\n<table>\n    <tr>\n        "),___v1ew.push(can.view.txt(0,"tr",0,this,function(){var a=[];return list(type.list,function(b){a.push("\n            <th>\n                "),a.push(can.view.txt(0,"th",0,this,function(){var a=[];return b.options.orderBy?(a.push('\n                <a href="#" class="sortable asc" data-order-by="'),a.push(can.view.txt(1,"a","data-order-by",this,function(){return b.options.orderBy})),a.push('"',can.view.pending(),">"),a.push("\n                    "),a.push(can.view.txt(1,"a",0,this,function(){return b.getName()})),a.push("\n                </a>\n                ")):(a.push("\n                    "),a.push(can.view.txt(1,"th",0,this,function(){return b.getName()})),a.push("\n                ")),a.join("")})),a.push("\n            </th>\n        ")}),a.join("")})),___v1ew.push("\n    "),___v1ew.push(can.view.txt(0,"tr",0,this,function(){var a=[];return canUpdate&&a.push("<th>Edit</th>"),a.join("")})),___v1ew.push("\n    "),___v1ew.push(can.view.txt(0,"tr",0,this,function(){var a=[];return canDestroy&&a.push("<th>Delete</th>"),a.join("")})),___v1ew.push("\n    </tr>\n    "),___v1ew.push(can.view.txt(0,"table",0,this,function(){var a=[];return items.each(function(b,c){a.push("\n    <tr "),a.push(can.view.txt(1,"tr",1,this,function(){return can.proxy(function(a){var c=can.$(a);c.data("item",b)},this)})),a.push(' class="'),a.push(can.view.txt(1,"tr","class",this,function(){return c%2==0?"even":""})),a.push('"',can.view.pending(),">"),a.push("\n        "),a.push(can.view.txt(0,"tr",0,this,function(){var a=[];return list(type.list,function(c,d){a.push("\n            <td>\n                "),a.push(can.view.txt(0,"td",0,this,function(){var a=[];return 0===d&&(a.push('<a href="'),a.push(can.view.txt(1,"a","href",this,function(){return b.getRoute()})),a.push('"',can.view.pending(),">")),a.join("")})),a.push("\n                "),a.push(can.view.txt(0,"a",0,this,function(){return b.getDisplay(c,"list")})),a.push("\n                "),a.push(can.view.txt(0,"a",0,this,function(){var a=[];return 0===d&&a.push("</a>"),a.join("")})),a.push("\n            </td>\n        ")}),a.join("")})),a.push("\n        "),a.push(can.view.txt(0,"tr",0,this,function(){var a=[];return canUpdate&&(a.push('<td><a href="'),a.push(can.view.txt(1,"a","href",this,function(){return b.getRoute()})),a.push('"',can.view.pending(),">"),a.push("Edit</a></td>")),a.join("")})),a.push("\n        "),a.push(can.view.txt(0,"tr",0,this,function(){var a=[];return canDestroy&&a.push('<td><a href="#" class="delete">Delete</a></td>'),a.join("")})),a.push("\n    </tr>\n    ")}),a.join("")})),___v1ew.push('\n</table>\n<div class="admin-list-paging"></div>\n'),___v1ew.join("")}})),can.view.preload("views_admin-paginate_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<div class="pagination">\n  <ul>\n    <li class="'),___v1ew.push(can.view.txt(1,"li","class",this,function(){return this.page?"":"disabled"})),___v1ew.push('"',can.view.pending(),">"),___v1ew.push('\n        <a href="'),___v1ew.push(can.view.txt(1,"a","href",this,function(){return can.route.url({route:route,type:type,page:this.page-1})})),___v1ew.push('" title="Previous Page"',can.view.pending(),">"),___v1ew.push("&laquo;</a>\n    </li>\n    "),___v1ew.push(can.view.txt(0,"ul",0,this,function(){var a=[];return this.pages&&a.push(can.view.txt(0,"ul",0,this,function(){for(var a=[],b=0;pages>b;b++)a.push("\n        "),a.push(can.view.txt(0,"ul",0,this,function(){var a=[];return(15>pages||b>page-4&&page+4>b||(b+1)%10===0||0===b||b===pages-1)&&(a.push('\n            <li class="'),a.push(can.view.txt(1,"li","class",this,function(){return this.page===b||!this.page&&0===b?"active":""})),a.push('"',can.view.pending(),">"),a.push('\n                <a href="'),a.push(can.view.txt(1,"a","href",this,function(){return can.route.url({route:route,type:type,page:b})})),a.push('"',can.view.pending(),">"),a.push(can.view.txt(1,"a",0,this,function(){return b+1})),a.push("</a>\n            </li>\n        ")),a.join("")})),a.push("\n    ");return a.join("")})),a.join("")})),___v1ew.push('\n    <li class="'),___v1ew.push(can.view.txt(1,"li","class",this,function(){return this.next?"":"disabled"})),___v1ew.push('"',can.view.pending(),">"),___v1ew.push('\n        <a href="'),___v1ew.push(can.view.txt(1,"a","href",this,function(){return can.route.url({route:route,type:type,page:this.page+1})})),___v1ew.push('" title="Next Page"',can.view.pending(),">"),___v1ew.push("&raquo;</a>\n    </li>\n  </ul>\n</div>\n"),___v1ew.join("")}})),can.view.preload("views_admin-prop_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<span class="'),___v1ew.push(can.view.txt(1,"span","class",this,function(){return cssClass})),___v1ew.push('"',can.view.pending(),">"),___v1ew.push(can.view.txt(1,"span",0,this,function(){return void 0!==this.val?val:""})),___v1ew.push("</span>\n"),___v1ew.join("")}})),can.view.preload("views_admin-radio_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];___v1ew.push('<div class="'),___v1ew.push(can.view.txt(1,"div","class",this,function(){return this.cssClass?this.cssClass:""})),___v1ew.push('"',can.view.pending(),">"),___v1ew.push("\n");var that=this;return ___v1ew.push("\n"),___v1ew.push(can.view.txt(0,"div",0,this,function(){var a=[];return list(options,function(b){a.push("\n    ");var c=b.constructor&&b.constructor.id?b[b.constructor.id]:b.value,d=that.displayProperty?can.getObject(displayProperty,b):can.capitalize(c),e=c===that.selected?"checked":"";a.push('\n    <label>\n        <input type="radio" name="'),a.push(can.view.txt(1,"input","name",this,function(){return name})),a.push('" value="'),a.push(can.view.txt(1,"input","value",this,function(){return c})),a.push('" '),a.push(can.view.txt(1,"input",1,this,function(){return e})),a.push("",can.view.pending(),">"),a.push("\n        "),a.push(can.view.txt(1,"input",0,this,function(){return d})),a.push("\n    </label>\n")}),a.join("")})),___v1ew.push("\n</div>\n"),___v1ew.join("")}})),can.view.preload("views_admin-select_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];___v1ew.push('<select class="'),___v1ew.push(can.view.txt(1,"select","class",this,function(){return this.cssClass?this.cssClass:""})),___v1ew.push('"\n    style="min-width: 220px; max-width: 600px;"\n    id="admin-edit-'),___v1ew.push(can.view.txt(1,"select","id",this,function(){return name})),___v1ew.push('"\n    name="'),___v1ew.push(can.view.txt(1,"select","name",this,function(){return name})),___v1ew.push('"\n    '),___v1ew.push(can.view.txt(1,"select",1,this,function(){return this.multiple?"multiple size='3'":""})),___v1ew.push("",can.view.pending(),">"),___v1ew.push("\n    ");var multiple=this.multiple,displayProperty=this.displayProperty,selected=this.selected;return ___v1ew.push("\n    "),___v1ew.push(can.view.txt(0,"select",0,this,function(){var a=[];return list(options,function(b){a.push("\n        ");var c=b.constructor&&b.constructor.id?b[b.constructor.id]:b.value,d=displayProperty?can.getObject(displayProperty,b):can.capitalize(c),e=(multiple?-1!==can.inArray(c,selected):c===selected)?"selected":"";a.push('\n        <option value="'),a.push(can.view.txt(1,"option","value",this,function(){return c})),a.push('" '),a.push(can.view.txt(1,"option",1,this,function(){return e})),a.push("",can.view.pending(),">"),a.push("\n            "),a.push(can.view.txt(1,"option",0,this,function(){return d})),a.push("\n        </option>\n    ")}),a.join("")})),___v1ew.push("\n</select>\n"),___v1ew.join("")}})),can.view.preload("views_admin-textarea_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<textarea class="'),___v1ew.push(can.view.txt(1,"textarea","class",this,function(){return this.cssClass?this.cssClass:""})),___v1ew.push('"\n    id="admin-edit-'),___v1ew.push(can.view.txt(1,"textarea","id",this,function(){return name})),___v1ew.push('"\n    name="'),___v1ew.push(can.view.txt(1,"textarea","name",this,function(){return name})),___v1ew.push('"\n    rows="'),___v1ew.push(can.view.txt(1,"textarea","rows",this,function(){return this.rows})),___v1ew.push('"',can.view.pending(),">"),___v1ew.push(can.view.txt(0,"textarea",0,this,function(){return this.value})),___v1ew.push("</textarea>\n"),___v1ew.join("")}})),can.view.preload("views_admin_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<div class="can-admin">\n    <header>\n        <h2>Admin Area</h2>\n    </header>\n    <nav class="admin-breadcrumb"></nav>\n    <nav class="admin-entities">\n        <ul>\n            '),___v1ew.push(can.view.txt(0,"ul",0,this,function(){var a=[];return list(types,function(b){a.push('\n                <li>\n                    <a href="'),a.push(can.view.txt(1,"a","href",this,function(){return b.getRoute()})),a.push('"',can.view.pending(),">"),a.push('\n                        <i class="icon-'),a.push(can.view.txt(1,"i","class",this,function(){return b.getIcon()})),a.push('"',can.view.pending(),">"),a.push("</i>\n                        "),a.push(can.view.txt(1,"a",0,this,function(){return b.getNamePlural()})),a.push("\n                    </a>\n                </li>\n            ")}),a.join("")})),___v1ew.push("\n        </ul>\n        "),___v1ew.push(can.view.txt(0,"nav",0,this,function(){var a=[];return this.pages&&this.pages.length&&(a.push("\n        <hr>\n        <ul>\n            "),a.push(can.view.txt(0,"ul",0,this,function(){var a=[];return list(pages,function(b){a.push('\n                <li>\n                    <a href="'),a.push(can.view.txt(1,"a","href",this,function(){return b.getRoute()})),a.push('"',can.view.pending(),">"),a.push('\n                        <i class="icon-'),a.push(can.view.txt(1,"i","class",this,function(){return b.getIcon()})),a.push('"',can.view.pending(),">"),a.push("</i>\n                        "),a.push(can.view.txt(1,"a",0,this,function(){return b.getName()})),a.push("\n                    </a>\n                </li>\n            ")}),a.join("")})),a.push("\n        </ul>\n        ")),a.join("")})),___v1ew.push('\n    </nav>\n    <div class="admin-content"></div>\n</div>\n'),___v1ew.join("")}})),can.view.preload("views_breadcrumb_ejs",can.EJS(function(_CONTEXT,_VIEW){with(_VIEW)with(_CONTEXT){var ___v1ew=[];return ___v1ew.push('<a href="'),___v1ew.push(can.view.txt(1,"a","href",this,function(){return url})),___v1ew.push('"',can.view.pending(),">"),___v1ew.push(can.view.txt(1,"a",0,this,function(){return text})),___v1ew.push("</a>\n"),___v1ew.join("")}}))}),define("controls/list",["../views"],function(){var a=can.Control.extend({init:function(a,b){this.items=new can.Observe.List,a.html(can.view("../views/admin-list.ejs",{type:b.type,items:this.items})),b.search?(a.find(".admin-list-search").val(b.search),this.loadSearch(b.search)):this.loadPage(b.page)},"{routes.list} route":function(a){a.type===this.options.type.name&&this.loadPage()},"{routes.listPage} route":function(a){this.loadPage(a.page)},"{routes.listSearch} route":function(a){this.loadSearch(a.search)},loadPage:function(a){var b=this;a=can.isNumeric(a)?a:void 0,this.options.type.getAll(a).done(function(c){b.items.replace(c),b.initPaging(a),b.element.removeClass("admin-list-searchresults")})},initPaging:function(a){var b=this.options.type.getPagingParameters(),c=this.items.length!==b.max;if(a||!c){this.hasOwnProperty("count")||(this.count=this.options.type.getCount());var d=this;this.count.done(function(e){e<=b.max||!d.element||(a=a||0,d.element.find(".admin-list-paging").html(can.view("../views/admin-paginate.ejs",can.extend({route:d.options.routes.listPage,type:d.options.type.name,count:e,pages:Math.ceil(e/b.max),next:e?a<Math.floor(e/b.max):!c,page:parseInt(a)},b))))})}},loadSearch:function(a){this.element.addClass("admin-list-searchresults");var b=this;this.options.type.getSearch(a).done(function(c){a!==b.lastSearchTerm&&b.lastSearchTerm||b.items.replace(c)})},resetSearch:function(){window.location.hash=can.route.url({route:this.options.routes.list,type:this.options.type.name})},".delete click":function(a,b){b.preventDefault();var c=a.closest("tr"),d=c.data("item");window.confirm("Delete '"+d.getName()+"'?")&&d.destroy().done(function(){c.remove()})},".admin-list-search keyup":function(a,b){b.preventDefault();var c=a.val();if(this.lastSearchTerm=c,27===b.which)return a.val(""),void this.resetSearch();if(13!==b.which){var d=this;window.setTimeout(function(){c===d.lastSearchTerm&&(window.location.hash=can.route.url({route:d.options.routes.listSearch,type:d.options.type.name,search:c}),d.element.find(".admin-list-paging").empty())},200)}},".admin-list-reset click":function(){this.resetSearch()},".sortable click":function(a,b){b.preventDefault(),this.element.find(".sortable.active").removeClass("active"),a.addClass("active").removeClass("desc asc");var c=a.data("orderBy"),d=this.options.type;c!==d.sortProperty?(d.sortProperty=c,delete d.currentSortType,a.addClass("asc")):d.currentSortType&&d.currentSortType!==d.sortAscending?(d.currentSortType=d.sortAscending,a.addClass("asc")):(d.currentSortType=d.sortDescending,a.addClass("desc")),this.loadPage()}});return a}),define("controls/edit",["../views"],function(){var a=can.Control.extend({init:function(a,b){this.loadItem=can.when(b.id?b.type.getOne(b.id):b.type.createNew());var c=this;this.loadItem.done(function(d){c.item=d;var e=c.options.inline?a.find(".admin-edit-form"):a;e.html(can.view("../views/admin-edit.ejs",{type:b.type,inline:b.inline,item:d}))})},close:function(a){"function"==typeof this.options.onClose&&this.options.onClose(a),this.options.inline?this.element.remove():window.location.hash=this.options.type.getRoute()},"form submit":function(a,b){b.preventDefault();var c=this.item.saveForm(a);if(this.options.inline){var d=this;c.done(function(a){d.close(a)})}},".admin-edit-create click":function(b,c){c.preventDefault();var d=b.data("property"),e=d.getType(),f=this;this.element.after(can.view("../views/admin-edit-inline.ejs",{type:e}));new a(this.element.next(),{type:e,inline:!0,onClose:function(a){if(a){var c=f.item.serializeForm(b.closest("form")),e=can.map(c[d.getKey()]||[],function(a){return a.id});e.push(a.id),d.addWidgetOption(f.item.instance,a,e)}}})},".admin-edit-close click":function(a,b){b.preventDefault(),this.close()}});return a}),define("controls/main",["./list","./edit","../views"],function(a,b){var c=can.Control.extend({defaults:{routes:{main:"admin",page:"admin/page/:page",list:"admin/list/:type",listPage:"admin/list/:type/page/:page",listSearch:"admin/list/:type/search/:search",create:"admin/list/:type/create",edit:"admin/list/:type/edit/:id"}}},{setup:function(a,b){var c=b.types||(this.constructor.defaults?this.constructor.defaults.types:void 0),d=b.routes||this.constructor.defaults.routes;c&&c.forEach(function(a){if(a.routes=d,a.properties)for(var b in a.properties){var e=a.properties[b],f=e.getType();if(f&&"string"==typeof f){var g=this.getType(f,c);e.setType(g||void 0)}}},this);var e=b.pages||(this.constructor.defaults?this.constructor.defaults.pages:void 0);e&&e.forEach(function(a){a.routes=d}),can.Control.prototype.setup.call(this,a,b)},"{routes.main} route":"dashboard","{routes.list} route":"list","{routes.listPage} route":"list","{routes.listSearch} route":"list","{routes.create} route":"create","{routes.edit} route":"edit","{routes.page} route":"page",init:function(){this.initHtml()},initHtml:function(){this.element.html(can.view("../views/admin.ejs",{types:this.options.types,pages:this.options.pages}))},dashboard:function(){this.breadcrumb()},list:function(b){if(this.currentList!==b.type){this.breadcrumb(),this.currentList=b.type;{new a(this.element.find(".admin-content"),can.extend(b,{type:this.getType(b.type),routes:this.options.routes}))}}},create:function(a){this.breadcrumb();new b(this.element.find(".admin-content"),{type:this.getType(a.type)})},edit:function(a){this.breadcrumb();var c=new b(this.element.find(".admin-content"),{type:this.getType(a.type),id:a.id}),d=this;c.loadItem.done(function(a){d.appendToBreadcrumb(a.getName(),a.getRoute())})},page:function(a){this.breadcrumb();var b=this.getPage(a.page);b.initControl(this.element.find(".admin-content"))},getType:function(a,b){return b=b||this.options.types,can.grep(b,function(b){return b.name===a})[0]},getPage:function(a){return can.grep(this.options.pages,function(b){return b.name===a})[0]},breadcrumb:function(){delete this.currentList,this.element.find(".admin-breadcrumb").empty().length||this.initHtml(),this.element.find(".admin-content").replaceWith("<div class='admin-content'></div>"),this.appendToBreadcrumb("Admin",can.route.url({route:this.options.routes.main}));
var a=can.route.attr();if(a.type){var b=this.getType(a.type);this.appendToBreadcrumb(b.getName(),b.getRoute())}else if(a.page){var c=this.getPage(a.page);this.appendToBreadcrumb(c.getName(),c.getRoute())}},appendToBreadcrumb:function(a,b){this.element.find(".admin-breadcrumb").append(can.view("../views/breadcrumb.ejs",{url:b,text:a}))}});return c}),define("controls",["./controls/main","./controls/list","./controls/edit"],function(a,b,c){var d={Main:a,List:b,Edit:c};return d}),define("item",[],function(){var a=can.Construct.extend({init:function(a){for(var b in a)this[b]=a[b]},getName:function(){var a=this.displayProperty||this.type.displayProperty||"name",b=can.getObject(a,this.type.properties);return this.getDisplay(b)},getRoute:function(){return can.route.url({route:this.type.routes.edit,type:this.type.name,id:this.instance[this.instance.constructor.id||"id"]})},getDisplay:function(a,b){return a.getDisplay(this.instance,b)},getWidget:function(a){var b=this.instance.isNew()?"create":"update";return this.type.canUpdate()&&a.isEnabled(b)?a.getWidget(this.instance):"<span class='ro-property'>"+this.getDisplay(a,"edit")+"</span>"},serializeForm:function(a){var b=a.serializeArray(),c={};return b.forEach(function(a){var b=this.type.getProperty(a.name),d=b.parseValue(a.value);b&&b.isList?(c[a.name]=c[a.name]||[],c[a.name].push(d)):c[a.name]=d},this),c},save:function(a){this.type.edit.forEach(function(b){var c=a[b.getKey()],d=b.getKey();void 0===c?this.instance.removeAttr(d):this.instance.attr(d,c)},this);var b=this.instance.save();return this.instance.isNew()?this.callback(b,"onCreate"):this.callback(b,"onUpdate"),this.callback(b,"onError","fail"),b},saveForm:function(a){return this.save(this.serializeForm(a))},destroy:function(){var a=this.instance.destroy();return this.callback(a,"onDestroy"),this.callback(a,"onError","fail"),a},callback:function(a,b,c){if(this.type.callbacks){var d=this.type.callbacks[b];c=c||"done","function"==typeof d&&a[c](d)}}});return a}),define("type",["./item"],function(a){var b=can.Construct.extend({defaults:{actions:["create","update","destroy"],icon:"cog",paging:{limit:"limit",offset:"offset",n:25,noLimit:0},sortParameter:"orderBy",sortType:"orderType",sortAscending:"ASC",sortDescending:"DESC"}},{init:function(a){a=can.extend({},this.constructor.defaults,a);var b=function(b){return a.properties[b]},c=function(a){switch(typeof a){case"function":return a;case"string":return function(b){return can.getJSON(can.sub(a,b,!1))}}throw"No valid service definition "+a};for(var d in a)if("edit"===d||"list"===d)this[d]=can.map(a[d],b);else if("services"===d){this.services={};for(var e in a.services)this.services[e]=c(a.services[e])}else this[d]=a[d];this.edit=this.edit||can.map(a.properties,function(a){return a}),this.list=this.list||[this.edit[0]]},canCreate:function(){return this.supportsAction("create")},canUpdate:function(){return this.supportsAction("update")},canDestroy:function(){return this.supportsAction("destroy")},supportsAction:function(a){return-1!==can.inArray(a,this.actions)},canSearch:function(){return!(!this.services||!this.services.search)},getName:function(){return this.displayName||can.capitalize(this.name)},getNamePlural:function(){return this.displayNamePlural||this.getName()+"s"},getIcon:function(){return this.icon},_route:function(a){return can.route.url({route:this.routes[a],type:this.name})},getRoute:function(){return this._route("list")},getCreateRoute:function(){return this._route("create")},getProperty:function(a){for(var b in this.properties)if(this.properties[b].getKey()===a)return this.properties[b]},getPagingParameters:function(a){a=a||0;var b=this,c=function(a){return b.paging&&void 0!==b.paging[a]?b.paging[a]:b.constructor.defaults.paging[a]},d={};if(a===!0)d[c("limit")]=c("noLimit");else{var e=c("n");d[c("limit")]=e,d[c("offset")]=e*a}return d},getQueryParameters:function(a){return this.queryParameters?this.queryParameters[a]||{}:{}},getAll:function(a){var b=can.extend(this.getQueryParameters("findAll"),this.getPagingParameters(a));return this.sortParameter&&this.sortProperty&&(b[this.sortParameter]=this.sortProperty,this.currentSortType&&(b[this.sortType]=this.currentSortType)),this.returnItemList(this.model.findAll(b))},returnItemList:function(b){var c=this;return b.then(function(b){return can.map(b,function(b){return new a({type:c,instance:b})})})},getOne:function(b){var c=this,d=this.getQueryParameters("findOne");return d.id=b,this.model.findOne(d).then(function(b){return new a({type:c,instance:b})})},createNew:function(){var b=new this.model;return new a({type:this,instance:b})},getCount:function(){return this.services&&this.services.count?this.services.count(this.getQueryParameters("count")):(new can.Deferred).resolve()},getSearch:function(a){if(this.canSearch()){var b=can.extend({},this.getPagingParameters(0),this.getQueryParameters("search"),{s:a});return this.returnItemList(this.services.search(b))}return(new can.Deferred).resolve()}});return b}),define("page",[],function(){var a=can.Construct.extend({defaults:{icon:"cog"}},{init:function(a){a=can.extend({},this.constructor.defaults,a);for(var b in a)this[b]=a[b]},getRoute:function(){return can.route.url({route:this.routes.page,page:this.name})},getName:function(){return this.displayName||can.capitalize(this.name)},getIcon:function(){return this.icon},initControl:function(a){return new this.control(a,this.controlOptions)}});return a}),define("admin",["./properties","./controls","./type","./page"],function(a,b,c,d){return{Properties:a,Controls:b,Type:c,Page:d}}),require("admin")});